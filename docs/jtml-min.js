(()=>{var t=(t,e,n)=>new Promise((r,l)=>{var o=t=>{try{u(n.next(t))}catch(t){l(t)}},i=t=>{try{u(n.throw(t))}catch(t){l(t)}},u=t=>t.done?r(t.value):Promise.resolve(t.value).then(o,i);u((n=n.apply(t,e)).next())});function e(t){let e=new Array(t.length);for(let r=0;r<t.length;r++){let l=n(t[r]);l&&(e[r]=l)}return e}function n(t){if(t.nodeType===Node.TEXT_NODE){let e=t.textContent;return e&&e.length?{type:"text",raw:e}:null}if(t.nodeType!==Node.ELEMENT_NODE)return null;let n=t.getAttribute("jt-foreach"),r=t.getAttribute("jt-text"),o=function(t){let e=[];for(let n of t.attributes)if(n.name.startsWith("jt-attr:")){let[,t]=n.name.split(":");e.push((e,r)=>{e.setAttribute(t,l(r,n.value))})}return e}(t),i=function(t){let e=t.getAttribute("jt-if");if(!e)return null;let n,r={eq:(t,e)=>t===e,neq:(t,e)=>t!==e,gt:(t,e)=>t>e,lt:(t,e)=>t<e,gte:(t,e)=>t>=e,lte:(t,e)=>t<=e},[l,o,i]=e.trim().split(/\s+/),u=r[o];if(!u)throw new Error("Unknown operator: "+o);n=/^'.*'$/.test(i)?i.slice(1,-1):isNaN(Number(i))?t=>t[i]:Number(i);let c=t=>t[l];return t=>{let e=c(t),r="function"==typeof n?n(t):n;return u(e,r)}}(t);return{type:"element",node:t,foreach:n,text:r,ifExpr:i,binders:o,children:e(t.childNodes)}}function r(t,e,n){let{type:o,node:i,foreach:u,text:c,ifExpr:f,binders:a,children:d}=t;if("text"===o)return document.createTextNode(t.raw);if(f&&!f(e))return;if(u){let t=l(e,u);if(!Array.isArray(t))return null;let o=document.createDocumentFragment();for(let e of t){let t=i.cloneNode(!1);for(let l of d){let o=r(l,e,n);o&&t.appendChild(o)}o.appendChild(t)}return o}let s=n?i.cloneNode(!1):i;if(c){let t=l(e,c);t&&(s.textContent=t)}for(let t of a)t(s,e);for(let t of d){let l=r(t,e,n);n&&l&&s.appendChild(l)}return s}function l(t,e){if("."===e)return t;return o(t,e)||function(t,e){let n="",r=0;for(;r<t.length;){let l=t.indexOf("{{",r);if(-1===l){n+=t.slice(r);break}n+=t.slice(r,l);let i=t.indexOf("}}",l);if(-1===i){n+=t.slice(l);break}n+=o(e,t.slice(l+2,i).trim()),r=i+2}return n}(e,t)}function o(t,e){let n=t;for(let t=0,r=e.split(".");t<r.length;t++){if(null==n)return;n=n[r[t]]}return n}var i=["jt-click","jt-submit","jt-input","jt-change","jt-load"],u={apply:function(t=document.body){let e=t.querySelectorAll("[jt-scope]");for(let t of e)u.bindDom(t)},bindDom:function(t,e=t){var n;console.log("Processing JTML el:",e);let r=null==(n=window[e.getAttribute("jt-scope")])?void 0:n.call(window),l=e.querySelectorAll(`form,a,[${i.join("],[")}]`);for(let e of l)if(!e._redered){switch(e.tagName){case"FORM":c(t,e,"submit");break;case"A":c(t,e,"click");break;default:a(t,e,r)}e._redered=!0}}};function c(e,n,r){let l=f(e,n),o=r=>{r&&r.preventDefault(),function(e,n,r){t(this,null,function*(){let l=p(e,n,"jt-loading"),o=p(e,n,"jt-error");h(l),m(o);try{let e=yield function(e){return t(this,null,function*(){let{url:t,options:n}=function(t){let e=t.getAttribute("action")||t.getAttribute("href"),n=(t.getAttribute("method")||"GET").toUpperCase(),r={method:n,headers:{}};if(["post","put","patch"].includes(n)){let e=function(t){if("FORM"!==t.tagName)return{};let e=new FormData(t),n={};for(let[t,r]of e.entries())n[t]=r;return n}(t);r.body=JSON.stringify(e),r.headers={"Content-Type":"application/json"}}return{url:e,options:r}}(e),r=e.getAttribute("jt-pre-request-fn");if(r){(0,window[r])(e,n)}try{let r=yield fetch(t,n),l=yield function(t){var e;return null!=(e=t.headers.get("Content-Type"))&&e.includes("text/html")?t.text():t.json()}(r),o=e.getAttribute("jt-post-request-fn");if(o){(0,window[o])(e,r,l)}if(!r.ok)throw{status:r.status,body:l};return l}catch(n){if(e.getAttribute("jt-request-error-fn")){let t=window[t];t(e,n)}throw console.error("[jtml] fetch failed:",t,n),n}})}(n);m(l),m(o),r(e)}catch(t){m(l),h(o),console.error("Form request failed:",t)}})}(e,n,l)};n.hasAttribute("jt-load")&&o(),n.addEventListener(r,o)}function f(t,n){let l,o=function(t){let e=t.getAttribute("jt-swap")||"replace",n=t.hasAttribute("jt-html");switch(e){case"replace":return function(t){return t?(t,e)=>t.innerHTML=e:(t,e)=>t.replaceChildren(e)}(n);case"append":return function(t){return t?(t,e)=>t.innerHTML+=e:(t,e)=>t.appendChild(e)}(n);case"prepend":return function(t){return t?(t,e)=>t.innerHTML=e+t.innerHTML:(t,e)=>t.prepend(e)}(n)}}(n),i=p(t,n,"jt-target"),c=p(t,n,"jt-render");return c&&(l=function(t){let n=t instanceof HTMLTemplateElement,l=e(n?t.content.childNodes:t.children);return function(t){let e=n?document.createDocumentFragment():null;for(let o of l){let l=r(o,t,n);n&&l&&e.appendChild(l)}return e}}(c)),e=>{let n=e;l&&(n=l(e)),n&&i&&(o(i,n),u.bindDom(t,i))}}function a(t,e,n){for(let r of i){let l=e.getAttribute(r);if(null===l)continue;let o=f(t,e);"jt-load"!==r?e.addEventListener(s(r),t=>d(e,l,o,n,t)):d(e,l,o,n)}}function d(t,e,n,r,l){let o=window[e],i=null==o?void 0:o(t,l);i instanceof Promise?i.then(()=>{n(r)}):n(r)}function s(t){return t.slice(3)}function p(t,e,n){let r=e.getAttribute(n);if(!r)return null;try{return t.querySelector(r)}catch(t){return console.warn(`[jtml] Invalid ${n} selector "${r}"`),null}}function h(t){t&&(t.style.display="")}function m(t){t&&(t.style.display="none")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>u.apply()):u.apply(),window.JTML=u})();