(()=>{var q=Object.defineProperty;var x=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var A=(t,n,e)=>n in t?q(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,b=(t,n)=>{for(var e in n||(n={}))P.call(n,e)&&A(t,e,n[e]);if(x)for(var e of x(n))$.call(n,e)&&A(t,e,n[e]);return t};var l=(t,n,e)=>new Promise((r,o)=>{var c=i=>{try{a(e.next(i))}catch(u){o(u)}},s=i=>{try{a(e.throw(i))}catch(u){o(u)}},a=i=>i.done?r(i.value):Promise.resolve(i.value).then(c,s);a((e=e.apply(t,n)).next())});var m={"x-get":"GET","x-post":"POST","x-put":"PUT","x-patch":"PATCH","x-delete":"DELETE"},C=["click","submit","input","change"],L={paginate:{post:J}},S=b({},L),v=[];function f(t=document){Object.keys(m).forEach(n=>{t.querySelectorAll(`[${n}]`).forEach(r=>{R(r,n)})}),M(t)}function M(t){t.querySelectorAll("[x-loading], [x-error]").forEach(n=>{n.style.display="none"})}function R(t,n){let e=B(t);if(e){let{name:r,triggerEl:o}=e;o.addEventListener(r,c=>{c.preventDefault(),w(t,n)})}else w(t,n)}function B(t){for(let n of t.attributes){if(!n.name.startsWith("x-"))continue;let e=n.name.slice(2);if(C.includes(e))return{name:e,triggerEl:E(t,n.name)}}return null}function y(t,n){try{let e=t.querySelector(n);return e||null}catch(e){return console.warn(`[jtml] Invalid selector '${n}':`,e),null}}function E(t,n){let e=t.getAttribute(n);if(!e)return t;let r=y(t,e);return r||(console.warn(`[jtml] Selector '${e}' from ${n} not found in:`,t),t)}function I(t,n){let e=t.getAttribute(n);if(!e)return t;let r=y(t,e);if(!r){let o=t.closest("[x-scoped]");return o?y(o,e):(console.warn(`[jtml] Selector '${e}' from ${n} not found in:`,t),t)}return r}function w(t,n){return l(this,null,function*(){if(!m[n])return;let r=I(t,"x-target");d(t,"[x-loading]"),g(t,"[x-error]"),g(t,"[x-error-data]");try{let o=yield O(t,n);U(t,o,r)}catch(o){console.error("[jtml] fetch failed:",o),d(t,"[x-error]"),h(t,o)}finally{g(t,"[x-loading]")}})}function O(t,n){return l(this,null,function*(){return t.getAttribute("x-test-data")?W(t):F(t,n)})}function U(t,n,e){if(n.error){k(t,n);return}t.hasAttribute("x-html")?(e.innerHTML=n.data,f(e)):(H(t,n.data,e),T(t,"post",n.data))}function k(t,n){let e=t.querySelector("[x-error-data]");if(!e||!n.data){d(t,"[x-error]");return}d(t,"[x-error-data]"),h(e,n.data)}function W(t){let n=t.getAttribute("x-test-data");if(n)try{let e=JSON.parse(n);return console.info("[jtml] Using x-test-data"),{data:e}}catch(e){return console.error("[jtml] Invalid x-test-data:",e),{error:e}}}function F(t,n){return l(this,null,function*(){let e=t.getAttribute(n),r=m[n],o=T(t,"pre"),c={method:r,headers:o.headers||{}};if(["POST","PUT","PATCH"].includes(r)){let a=G(t);c.headers["Content-Type"]="application/json",c.body=JSON.stringify(a)}try{let a=yield fetch(e,c),i=a.status>=400;if(t.hasAttribute("x-html")){let D=yield a.text();return{error:i,data:D}}let u=yield a.json();return{error:i,data:u}}catch(a){throw console.error("[jtml] fetch failed:",e,a),{error:a}}})}function H(t,n,e){let r=t.querySelector("template");if(!r)return;let o=r.content.cloneNode(!0);e.innerHTML="",N(o,n,e),h(o,n),j(o,n),e.appendChild(o)}function N(t,n){t.querySelectorAll("[x-foreach]").forEach(r=>{let o=r.getAttribute("x-foreach"),c=o?p(n,o):n;if(!Array.isArray(c)){console.warn("x-foreach expected an array but got",c);return}let s=document.createDocumentFragment();c.forEach(a=>{let i=r.cloneNode(!0);h(i,a),j(i,a),s.appendChild(i)}),r.replaceWith(s)})}function h(t,n){t.querySelectorAll&&t.querySelectorAll("[x-text]").forEach(e=>{let r=e.getAttribute("x-text"),o=p(n,r);e.removeAttribute("x-text"),e.textContent=o})}function j(t,n){let e=t.querySelectorAll("*");for(let r of e)for(let o of r.attributes){if(!o.name.startsWith("x-attr:"))continue;let c=o.name.slice(7),s=o.value,a=p(n,s);a&&r.setAttribute(c,a),r.removeAttribute(o.name)}}function d(t,n){try{let e=t.querySelector(n);if(!e)return;e.style.display==="none"&&(e.style.display="")}catch(e){console.warn(`[jtml] Invalid selector '${n}' inside element:`,t)}}function g(t,n){try{let e=t.querySelector(n);if(!e)return;e.style.display="none"}catch(e){console.warn(`[jtml] Invalid selector '${n}' inside element:`,t)}}function G(t){let n=E(t,"x-submit");if(n.tagName!=="FORM")return{};let e=new FormData(n),r={};for(let[o,c]of e.entries())r[o]=c;return r}function p(t,n){return n.split(".").reduce((e,r)=>{if(e)return e[r]},t)}function J(t){let n=t.el,e=n.getAttribute("x-get");if(!e)return;let r;try{r=new URL(e,window.location.href)}catch(s){console.warn("[jtml] Invalid x-get URL for pagination:",e);return}let o=parseInt(r.searchParams.get("page")||"1",10);r.searchParams.set("page",o+1);let c=r.origin===window.location.origin?r.pathname+r.search:r.toString();n.setAttribute("x-get",c)}function T(t,n,e){let r=Array.from(t.attributes).filter(c=>c.name.startsWith("x-action-")),o={el:t,response:e};for(let c of r){let s=c.name.slice(9),a=S[s],i=a==null?void 0:a[n];if(typeof i!="function"){console.warn(`[jtml] Action "${s}" does not have a valid ${n}() function`);continue}i(o)}return v.forEach(c=>{if(typeof c!="function"){console.warn("[jtml] Registered global action is not a function:",c);return}c(o)}),o}document.readyState!=="loading"?f(document.body):document.addEventListener("DOMContentLoaded",()=>f(document.body));window.jtml={render:f,addGlobalAction:t=>{typeof t=="function"&&v.push(t)},registerAction:(t,n)=>{t.startsWith("user:")||console.warn(`[jtml] Custom actions should be prefixed with "user:". Got "${t}".`),S[t]=n}};})();
//# sourceMappingURL=jtml-min.js.map
