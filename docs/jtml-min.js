(()=>{var $=Object.defineProperty;var x=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var b=(t,n,e)=>n in t?$(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,A=(t,n)=>{for(var e in n||(n={}))q.call(n,e)&&b(t,e,n[e]);if(x)for(var e of x(n))O.call(n,e)&&b(t,e,n[e]);return t};var l=(t,n,e)=>new Promise((r,o)=>{var c=a=>{try{i(e.next(a))}catch(u){o(u)}},s=a=>{try{i(e.throw(a))}catch(u){o(u)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(c,s);i((e=e.apply(t,n)).next())});var P={var:(t,n)=>L(t,n)};function w(t,n){let e=t.content.cloneNode(!0);return h(e,n),e}function h(t,n){let e=t.children;if(e)for(let r of e){if(r.hasAttribute("x-foreach")){k(r,n);continue}h(r,n),C(r,n)}}function k(t,n){let e=t.getAttribute("x-foreach"),r=e?g(n,e):n;if(!Array.isArray(r)){console.warn("x-foreach expected an array but got",r);return}let o=document.createDocumentFragment();r.forEach(c=>{let s=t.cloneNode(!0);s.removeAttribute("x-foreach"),h(s,c),o.appendChild(s)}),t.replaceWith(o)}function C(t,n){let e=t.parentNode.querySelectorAll("*");for(let r of e)for(let o of r.attributes){if(console.log(o),!o.name.startsWith("x-"))continue;r.removeAttribute(o.name);let[c,s]=o.name.slice(2).split(":"),i=o.value,a=P[s],u;a?u=a(i,n):u=g(n,i),console.log(c,u),c==="text"?r.textContent=u:r.setAttribute(c,u)}}function g(t,n){return n.split(".").reduce((e,r)=>{if(e)return e[r]},t)}function L(t,n){let e="",r=0;for(;r<t.length;){let o=t.indexOf("{{",r);if(o===-1){e+=t.slice(r);break}e+=t.slice(r,o);let c=t.indexOf("}}",o);if(c===-1){e+=t.slice(o);break}let s=t.slice(o+2,c).trim();e+=g(n,s),r=c+2}return e}var y={"x-get":"GET","x-post":"POST","x-put":"PUT","x-patch":"PATCH","x-delete":"DELETE"},M=["click","submit","input","change"],R={paginate:{post:X}},E=A({},R),S=[];function f(t=document){Object.keys(y).forEach(n=>{t.querySelectorAll(`[${n}]`).forEach(r=>{U(r,n)})}),I(t)}function I(t){t.querySelectorAll("[x-loading], [x-error]").forEach(n=>{n.style.display="none"})}function U(t,n){let e=B(t);if(e){let{name:r,triggerEl:o}=e;o.addEventListener(r,c=>{c.preventDefault(),v(t,n)})}else v(t,n)}function B(t){for(let n of t.attributes){if(!n.name.startsWith("x-"))continue;let e=n.name.slice(2);if(M.includes(e))return{name:e,triggerEl:j(t,n.name)}}return null}function p(t,n){try{let e=t.querySelector(n);return e||null}catch(e){return console.warn(`[jtml] Invalid selector '${n}':`,e),null}}function j(t,n){let e=t.getAttribute(n);if(!e)return t;let r=p(t,e);return r||(console.warn(`[jtml] Selector '${e}' from ${n} not found in:`,t),t)}function W(t,n){let e=t.getAttribute(n);if(!e)return t;let r=p(t,e);if(!r){let o=t.closest("[x-scoped]");return o?p(o,e):(console.warn(`[jtml] Selector '${e}' from ${n} not found in:`,t),t)}return r}function v(t,n){return l(this,null,function*(){if(!y[n])return;let r=W(t,"x-target");d(t,"[x-loading]"),m(t,"[x-error]"),m(t,"[x-error-data]");try{let o=yield N(t,n);F(t,o,r)}catch(o){console.error("[jtml] fetch failed:",o),d(t,"[x-error]")}finally{m(t,"[x-loading]")}})}function N(t,n){return l(this,null,function*(){return t.getAttribute("x-test-data")?G(t):J(t,n)})}function F(t,n,e){if(n.error){H(t,n);return}if(t.hasAttribute("x-html"))e.innerHTML=n.data,f(e);else{let r=t.querySelector("template");if(!r)return;let o=w(r,n.data);e.innerHTML="",e.appendChild(o),T(t,"post",n.data)}}function H(t,n){let e=t.querySelector("[x-error-data]");if(!e||!n.data){d(t,"[x-error]");return}d(t,"[x-error-data]"),applyTextBindings(e,n.data)}function G(t){let n=t.getAttribute("x-test-data");if(n)try{let e=JSON.parse(n);return console.info("[jtml] Using x-test-data"),{data:e}}catch(e){return console.error("[jtml] Invalid x-test-data:",e),{error:e}}}function J(t,n){return l(this,null,function*(){let e=t.getAttribute(n),r=y[n],o=T(t,"pre"),c={method:r,headers:o.headers||{}};if(["POST","PUT","PATCH"].includes(r)){let i=V(t);c.headers["Content-Type"]="application/json",c.body=JSON.stringify(i)}try{let i=yield fetch(e,c),a=i.status>=400;if(t.hasAttribute("x-html")){let D=yield i.text();return{error:a,data:D}}let u=yield i.json();return{error:a,data:u}}catch(i){throw console.error("[jtml] fetch failed:",e,i),{error:i}}})}function d(t,n){try{let e=t.querySelector(n);if(!e)return;e.style.display==="none"&&(e.style.display="")}catch(e){console.warn(`[jtml] Invalid selector '${n}' inside element:`,t)}}function m(t,n){try{let e=t.querySelector(n);if(!e)return;e.style.display="none"}catch(e){console.warn(`[jtml] Invalid selector '${n}' inside element:`,t)}}function V(t){let n=j(t,"x-submit");if(n.tagName!=="FORM")return{};let e=new FormData(n),r={};for(let[o,c]of e.entries())r[o]=c;return r}function X(t){let n=t.el,e=n.getAttribute("x-get");if(!e)return;let r;try{r=new URL(e,window.location.href)}catch(s){console.warn("[jtml] Invalid x-get URL for pagination:",e);return}let o=parseInt(r.searchParams.get("page")||"1",10);r.searchParams.set("page",o+1);let c=r.origin===window.location.origin?r.pathname+r.search:r.toString();n.setAttribute("x-get",c)}function T(t,n,e){let r=Array.from(t.attributes).filter(c=>c.name.startsWith("x-action-")),o={el:t,response:e};for(let c of r){let s=c.name.slice(9),i=E[s],a=i==null?void 0:i[n];if(typeof a!="function"){console.warn(`[jtml] Action "${s}" does not have a valid ${n}() function`);continue}a(o)}return S.forEach(c=>{if(typeof c!="function"){console.warn("[jtml] Registered global action is not a function:",c);return}c(o)}),o}document.readyState!=="loading"?f(document.body):document.addEventListener("DOMContentLoaded",()=>f(document.body));window.jtml={render:f,addGlobalAction:t=>{typeof t=="function"&&S.push(t)},registerAction:(t,n)=>{t.startsWith("user:")||console.warn(`[jtml] Custom actions should be prefixed with "user:". Got "${t}".`),E[t]=n}};})();
//# sourceMappingURL=jtml-min.js.map
