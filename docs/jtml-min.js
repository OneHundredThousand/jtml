(()=>{var t=Object.defineProperty,e=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(e,r,n)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,i=(t,i)=>{for(var o in i||(i={}))r.call(i,o)&&l(t,o,i[o]);if(e)for(var o of e(i))n.call(i,o)&&l(t,o,i[o]);return t},o=(t,e,r)=>new Promise((n,l)=>{var i=t=>{try{u(r.next(t))}catch(t){l(t)}},o=t=>{try{u(r.throw(t))}catch(t){l(t)}},u=t=>t.done?n(t.value):Promise.resolve(t.value).then(i,o);u((r=r.apply(t,e)).next())});function u(t){let e=[];for(let r of t){let t=f(r);t&&e.push(t)}return e}function f(t){if(t.nodeType===Node.TEXT_NODE){let e=t.textContent;return e&&e.length?{type:"text",raw:e}:null}if(t.nodeType!==Node.ELEMENT_NODE)return null;let e=t.getAttribute("jt-foreach"),r=a(t.getAttribute("jt-text")),n=function(t){let e=[];for(let r of t.attributes)if(r.name.startsWith("jt-attr:")){let[,t]=r.name.split(":"),n=a(r.value);e.push((e,r)=>{e.setAttribute(t,n(r))})}return e}(t),l=function(t){let e=t.getAttribute("jt-if");if(!e)return null;let r,n={eq:(t,e)=>t===e,neq:(t,e)=>t!==e,gt:(t,e)=>t>e,lt:(t,e)=>t<e,gte:(t,e)=>t>=e,lte:(t,e)=>t<=e},[l,i,o]=e.trim().split(/\s+/),u=n[i];if(!u)throw new Error("Unknown operator: "+i);r=/^'.*'$/.test(o)?o.slice(1,-1):isNaN(Number(o))?t=>t[o]:Number(o);let f=t=>t[l];return t=>{let e=f(t),n="function"==typeof r?r(t):r;return u(e,n)}}(t);return{type:"element",node:t,foreach:e,text:r,ifExpr:l,binders:n,children:u(t.childNodes)}}function a(t){if(""===t)return t=>t;if(!t||!t.length)return;let e=[],r=t.length,n=0,l=0;for(;n<r;){if("{"!==t[n]){n++;continue}n>l&&e.push({type:"text",value:t.slice(l,n)});let i=n+1,o=i;for(;o<r&&"}"!==t[o];)o++;if(o===r)return e.push({type:"text",value:t.slice(n)}),e;e.push({type:"path",value:t.slice(i,o)}),n=o+1,l=n}return l<r&&e.push({type:"text",value:t.slice(l)}),t=>{let r="";if(1===e.length){let n=d(t,e[0].value);r+=n?String(n):e[0].value}else for(let n of e)if("text"!==n.type){if("path"===n.type){let e=d(t,n.value);r+=e?String(e):n.value}}else r+=n.value;return r}}function c(t,e,r){let{type:n,node:l,foreach:i,text:o,ifExpr:u,binders:f,children:a}=t;if("text"===n)return document.createTextNode(t.raw);if(u&&!u(e))return;if(null!==i){let t=d(e,i);if(!Array.isArray(t))return null;let n=document.createDocumentFragment();for(let e of t){let t=l.cloneNode(!1);for(let n of a){let l=c(n,e,r);r&&l&&t.appendChild(l)}n.appendChild(t)}return n}let p=r?l.cloneNode(!1):l;if(o){let t=o(e);t&&(p.textContent=t)}for(let t of f)t(p,e);for(let t of a){let n=c(t,e,r);r&&n&&p.appendChild(n)}return p}function d(t,e){if(""===e)return t;let r=t;for(let t of e.split(".")){if(!r)return;r=r[t]}return r}var p=["jt-click","jt-submit","jt-input","jt-change","jt-load"],s={data:{},add(t,e){this.data[t]=e},get(t){return this.data[t]}},h={apply:function(t=document.body){let e=t.querySelectorAll(`[${p.join("],[")}]`);for(let t of e)t._redered||(y(t),t._redered=!0);__DEBUG__&&debug(t)},store:s};if(__DEBUG__){document.currentScript}function y(t){let e=b(t);for(let r of p){let n=t.getAttribute(r);if(null!==n){if("jt-load"===r){m(t,n,e);continue}t.addEventListener(r.slice(3),r=>m(t,n,e,r))}}}function m(t,e,r,n){return o(this,null,function*(){if(n&&n.preventDefault(),!1===(yield j(e,t,n)))return;let l={},u=s.get(t.getAttribute("jt-source"));if(u&&(l=u),["FORM","A"].includes(t.tagName)){let e=yield function(t){return o(this,null,function*(){let e=v(t,"jt-loading"),r=v(t,"jt-error");A(e),T(r);try{let n=yield function(t){return o(this,null,function*(){let{url:e,options:r}=function(t){let e=t.getAttribute("action")||t.getAttribute("href"),r=(t.getAttribute("method")||"GET").toUpperCase(),n={method:r,headers:{}};if(["POST","PUT","PATCH"].includes(r)){let e=function(t){let e=new FormData(t),r={};for(let[t,n]of e.entries())r[t]=n;return r}(t);n.body=JSON.stringify(e),n.headers={"Content-Type":"application/json"}}if("GET"===r){let r=new FormData(t),n=new URLSearchParams(r),l=new URL(e,window.location.href);l.search=n,e=l.toString()}return{url:e,options:n}}(t);try{yield j(t.getAttribute("jt-pre-request-fn"),t,r);let n=yield fetch(e,r),l=yield function(t){return t.headers.get("Content-Type").includes("text/html")?t.text():t.json()}(n);if(yield j(t.getAttribute("jt-post-request-fn"),t,n,l),!n.ok)throw{status:n.status,body:l};return l}catch(r){throw yield j(t.getAttribute("jt-request-error-fn"),t,r),console.error("[jtml] fetch failed:",e,r),r}})}(t);return T(e),T(r),n}catch(t){T(e),A(r),console.error("Form request failed:",t)}})}(t);if(!e)return;let n=t.getAttribute("jt-store");return n&&s.add(n,e),void g(t,r,l?i(i({},l),e):e)}g(t,r,l)})}function g(t,e,r){e&&e(r);let n=w(t,"jt-after")||[];for(let t of n){m(t,"",b(t))}}function b(t){let e=function(t){if(t.hasAttribute("jt-html"))return t=>t;let e=v(t,"jt-render");if(!e)return;if(e._compiled)return e._compiled;let r=function(t){let e=t instanceof HTMLTemplateElement,r=u(e?t.content.childNodes:[t]);return function(t){let n=e?document.createDocumentFragment():null;for(let l of r){let r=c(l,t,e);e&&r&&n.appendChild(r)}return n}}(e);return e._compiled=r,r}(t);if(!e)return;let r=v(t,"jt-target")||t,n=function(t){let e=t.getAttribute("jt-swap")||"replace";return{replace:(t,e)=>"string"==typeof e?t.innerHTML=e:t.replaceChildren(e),append:(t,e)=>"string"==typeof e?t.innerHTML+=e:t.appendChild(e),prepend:(t,e)=>"string"==typeof e?t.innerHTML=e+t.innerHTML:t.prepend(e)}[e]}(t);return t=>function(t,e,r,n){let l=t(e);l&&(r(n,l),h.apply(n))}(e,t,n,r)}function j(t,...e){return o(this,null,function*(){let r=window[t];return r&&r(...e)})}function v(t,e){let r=t.getAttribute(e);if(!r)return null;try{return document.querySelector(r)}catch(t){return console.warn(`[jtml] Invalid ${e} selector "${r}"`),null}}function w(t,e){let r=t.getAttribute(e);if(!r)return null;try{return document.querySelectorAll(r)}catch(t){return console.warn(`[jtml] Invalid ${e} selector "${r}"`),null}}function A(t){t&&(t.style.display="")}function T(t){t&&(t.style.display="none")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>h.apply()):h.apply(),window.JTML=h})();