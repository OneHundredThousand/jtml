(()=>{var t=(t,e,n)=>new Promise((r,o)=>{var i=t=>{try{u(n.next(t))}catch(t){o(t)}},c=t=>{try{u(n.throw(t))}catch(t){o(t)}},u=t=>t.done?r(t.value):Promise.resolve(t.value).then(i,c);u((n=n.apply(t,e)).next())});function e(t){if(t.nodeType===Node.TEXT_NODE){const e=t.textContent;return e&&e.length?{type:"text",raw:e}:null}if(t.nodeType!==Node.ELEMENT_NODE)return null;const n=t.getAttribute("jt-foreach"),o=t.getAttribute("jt-text"),i=function(t){const e=[];for(let n of t.attributes)if(n.name.startsWith("jt-attr:")){const[,t]=n.name.split(":");e.push((e,o)=>{e.setAttribute(t,r(o,n.value))})}return e}(t),c=function(t){const e=t.getAttribute("jt-if");if(!e)return null;const n={eq:(t,e)=>t===e,neq:(t,e)=>t!==e,gt:(t,e)=>t>e,lt:(t,e)=>t<e,gte:(t,e)=>t>=e,lte:(t,e)=>t<=e},[r,o,i]=e.trim().split(/\s+/),c=n[o];if(!c)throw new Error("Unknown operator: "+o);let u;u=/^'.*'$/.test(i)?i.slice(1,-1):isNaN(Number(i))?t=>t[i]:Number(i);const s=t=>t[r];return t=>{const e=s(t),n="function"==typeof u?u(t):u;return c(e,n)}}(t);return{type:"element",node:t,foreach:n,text:o,ifExpr:c,binders:i,children:Array.from(t.childNodes).map(e).filter(Boolean)}}function n(t,e,o){const{type:i,node:c,foreach:u,text:s,ifExpr:l,binders:a,children:f}=t;if("text"===i)return document.createTextNode(t.raw);if(l&&!l(e))return;if(u){const t=r(e,u);if(!Array.isArray(t))return null;const i=document.createDocumentFragment();for(const e of t){const t=c.cloneNode(!1);t.removeAttribute("jt-foreach");for(const r of f){const i=n(r,e,o);i&&t.appendChild(i)}i.appendChild(t)}return i}const d=o?c.cloneNode(!1):c;if(s){const t=r(e,s);t&&(d.textContent=t)}a.forEach(t=>t(d,e));for(const t of f){const r=n(t,e,o);o&&r&&d.appendChild(r)}return d}function r(t,e){if("."===e)return t;const n=o(t,e);return n||function(t,e){let n="",r=0;for(;r<t.length;){const i=t.indexOf("{{",r);if(-1===i){n+=t.slice(r);break}n+=t.slice(r,i);const c=t.indexOf("}}",i);if(-1===c){n+=t.slice(i);break}n+=o(e,t.slice(i+2,c).trim()),r=c+2}return n}(e,t)}function o(t,e){let n=t;for(let t=0,r=e.split(".");t<r.length;t++){if(null==n)return;n=n[r[t]]}return n}var i=["jt-click","jt-submit","jt-input","jt-change","jt-load"],c={apply:function(t=document){t.querySelectorAll("[jt-scope]").forEach(t=>{var e;console.log("Processing JTML scope:",t);const n=null==(e=window[t.getAttribute("jt-scope")])?void 0:e.call(window),r=t.querySelectorAll("form"),o=t.querySelectorAll("a");r.forEach(e=>function(t,e){const n=e.querySelectorAll("[jt-submit-form]"),r=u(t,e),o=n=>{n&&n.preventDefault(),l(t,e,r)};e.hasAttribute("jt-load")&&o();e.addEventListener("submit",o),n.forEach(t=>{const e=t.getAttribute("jt-submit-form");t.addEventListener(e,o)})}(t,e)),o.forEach(e=>function(t,e){const n=u(t,e),r=r=>{r&&r.preventDefault(),l(t,e,n)};e.hasAttribute("jt-load")&&r();e.addEventListener("click",r)}(t,e)),function(t,e){const n=t.querySelectorAll(`[${i.join("],[")}]`);for(const r of n)for(const n of i){if("FORM"===r.tagName||"A"===r.tagName)continue;if(!r.hasAttribute(n))continue;const o=r.getAttribute(n),i=u(t,r);"jt-load"!==n?r.addEventListener(f(n),t=>a(r,o,i,e,t)):a(r,o,i,e)}}(t,n)})}};function u(t,r){const o=function(t){const e=t.getAttribute("jt-swap")||"replace",n=t.hasAttribute("jt-html");switch(e){case"replace":return function(t){if(t)return(t,e)=>t.innerHTML=e;return(t,e)=>t.replaceChildren(e)}(n);case"append":return function(t){if(t)return(t,e)=>t.innerHTML+=e;return(t,e)=>t.appendChild(e)}(n);case"prepend":return function(t){if(t)return(t,e)=>t.innerHTML=e+t.innerHTML;return(t,e)=>t.prepend(e)}(n)}}(r);let i;const c=d(t,r,"jt-target"),u=d(t,r,"jt-render");return u&&(i=function(t){const r=t instanceof HTMLTemplateElement,o=Array.from(r?t.content.childNodes:t.children).map(e).filter(Boolean);return function(t){const e=r?document.createDocumentFragment():null;for(const i of o){const o=n(i,t,r);r&&o&&e.appendChild(o)}return e}}(u)),t=>{let e=t;i&&(e=i(t)),e&&c&&o(c,e)}}function s(e){return t(this,null,function*(){const{url:t,options:n}=function(t){const e=t.getAttribute("action")||t.getAttribute("href"),n=(t.getAttribute("method")||"GET").toUpperCase(),r={method:n,headers:{}};if(["post","put","patch"].includes(n)){const e=function(t){if("FORM"!==t.tagName)return{};const e=new FormData(t),n={};for(const[t,r]of e.entries())n[t]=r;return n}(t);r.body=JSON.stringify(e),r.headers={"Content-Type":"application/json"}}return{url:e,options:r}}(e),r=e.getAttribute("jt-pre-request-fn");if(r){(0,window[r])(e,n)}try{const r=yield fetch(t,n),o=yield function(t){var e;if(null==(e=t.headers.get("Content-Type"))?void 0:e.includes("text/html"))return t.text();return t.json()}(r),i=e.getAttribute("jt-post-request-fn");if(i){(0,window[i])(e,r,o)}if(!r.ok)throw{status:r.status,body:o};return o}catch(n){if(e.getAttribute("jt-request-error-fn")){const t=window[t];t(e,n)}throw console.error("[jtml] fetch failed:",t,n),n}})}function l(e,n,r){return t(this,null,function*(){const t=d(e,n,"jt-loading"),o=d(e,n,"jt-error");p(t),h(o);try{const e=yield s(n);h(t),h(o),r(e)}catch(e){h(t),p(o),console.error("Form request failed:",e)}})}function a(t,e,n,r,o){const i=window[e],c=null==i?void 0:i(t,o);c instanceof Promise?c.then(()=>{n(r)}):n(r)}function f(t){return t.slice(3)}function d(t,e,n){const r=e.getAttribute(n);if(!r)return null;try{return t.querySelector(r)}catch(t){return console.warn(`[jtml] Invalid ${n} selector "${r}"`),null}}function p(t){t&&(t.style.display="")}function h(t){t&&(t.style.display="none")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>c.apply()):c.apply(),window.JTML=c})();