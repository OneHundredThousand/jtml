(()=>{var t=(t,e,n)=>new Promise((r,l)=>{var i=t=>{try{u(n.next(t))}catch(t){l(t)}},o=t=>{try{u(n.throw(t))}catch(t){l(t)}},u=t=>t.done?r(t.value):Promise.resolve(t.value).then(i,o);u((n=n.apply(t,e)).next())});function e(t){let e=[];for(let r of t){let t=n(r);t&&e.push(t)}return e}function n(t){if(t.nodeType===Node.TEXT_NODE){let e=t.textContent;return e&&e.length?{type:"text",raw:e}:null}if(t.nodeType!==Node.ELEMENT_NODE)return null;let n=t.getAttribute("jt-foreach"),l=r(t.getAttribute("jt-text")),i=function(t){let e=[];for(let n of t.attributes)if(n.name.startsWith("jt-attr:")){let[,t]=n.name.split(":"),l=r(n.value);e.push((e,n)=>{e.setAttribute(t,l(n))})}return e}(t),o=function(t){let e=t.getAttribute("jt-if");if(!e)return null;let n,r={eq:(t,e)=>t===e,neq:(t,e)=>t!==e,gt:(t,e)=>t>e,lt:(t,e)=>t<e,gte:(t,e)=>t>=e,lte:(t,e)=>t<=e},[l,i,o]=e.trim().split(/\s+/),u=r[i];if(!u)throw new Error("Unknown operator: "+i);n=/^'.*'$/.test(o)?o.slice(1,-1):isNaN(Number(o))?t=>t[o]:Number(o);let f=t=>t[l];return t=>{let e=f(t),r="function"==typeof n?n(t):n;return u(e,r)}}(t);return{type:"element",node:t,foreach:n,text:l,ifExpr:o,binders:i,children:e(t.childNodes)}}function r(t){if(""===t)return t=>t;if(!t||!t.length)return;let e=[],n=t.length,r=0,l=0;for(;r<n;){if("{"!==t[r]){r++;continue}r>l&&e.push({type:"text",value:t.slice(l,r)});let i=r+1,o=i;for(;o<n&&"}"!==t[o];)o++;if(o===n)return e.push({type:"text",value:t.slice(r)}),e;e.push({type:"path",value:t.slice(i,o)}),r=o+1,l=r}return l<n&&e.push({type:"text",value:t.slice(l)}),t=>{let n="";if(1===e.length){let r=i(t,e[0].value);n+=r?String(r):e[0].value}else for(let r of e)if("text"!==r.type){if("path"===r.type){let e=i(t,r.value);n+=e?String(e):r.value}}else n+=r.value;return n}}function l(t,e,n){let{type:r,node:o,foreach:u,text:f,ifExpr:c,binders:a,children:d}=t;if("text"===r)return document.createTextNode(t.raw);if(c&&!c(e))return;if(null!==u){let t=i(e,u);if(!Array.isArray(t))return null;let r=document.createDocumentFragment();for(let e of t){let t=o.cloneNode(!1);for(let r of d){let i=l(r,e,n);n&&i&&t.appendChild(i)}r.appendChild(t)}return r}let s=n?o.cloneNode(!1):o;if(f){let t=f(e);t&&(s.textContent=t)}for(let t of a)t(s,e);for(let t of d){let r=l(t,e,n);n&&r&&s.appendChild(r)}return s}function i(t,e){if(""===e)return t;let n=t;for(let t of e.split(".")){if(!n)return;n=n[t]}return n}var o=["jt-click","jt-submit","jt-input","jt-change","jt-load"],u={apply:function(t=document.body){let e=t.querySelectorAll("[jt-scope]");for(let t of e)u.bindDom(t)},bindDom:function(t,e=t){console.log("Processing JTML el:",e);let n=window[e.getAttribute("jt-scope")],r=n&&n(),l=e.querySelectorAll(`[${o.join("],[")}]`);for(let e of l)e._redered||(f(t,e,r),e._redered=!0)}};function f(t,n,r){let i=d(t,n,"jt-source")||n,f=function(t,n){let r=function(t,n){if(n.hasAttribute("jt-html"))return t=>t;let r=d(t,n,"jt-render");if(!r)return;if(r._compiled)return r._compiled;let i=function(t){let n=t instanceof HTMLTemplateElement,r=e(n?t.content.childNodes:[t]);return function(t){let e=n?document.createDocumentFragment():null;for(let i of r){let r=l(i,t,n);n&&r&&e.appendChild(r)}return e}}(r);return r._compiled=i,i}(t,n);if(!r)return;let i=d(t,n,"jt-target")||n,o=function(t){let e=t.getAttribute("jt-swap")||"replace";return{replace:(t,e)=>"string"==typeof e?t.innerHTML=e:t.replaceChildren(e),append:(t,e)=>"string"==typeof e?t.innerHTML+=e:t.appendChild(e),prepend:(t,e)=>"string"==typeof e?t.innerHTML=e+t.innerHTML:t.prepend(e)}[e]}(n);return e=>function(t,e,n,r,l){let i=e(n);i&&(r(l,i),u.bindDom(t,l))}(t,r,e,o,i)}(t,n);for(let e of o){let l=n.getAttribute(e);if(null!==l){if("jt-load"===e){c(t,n,l,f,r,i);continue}n.addEventListener(e.slice(3),e=>c(t,n,l,f,r,i,e))}}}function c(e,n,r,l,i,o,u){return t(this,null,function*(){if(u&&u.preventDefault(),!1!==(yield a(r,n,u))&&l){if(["FORM","A"].includes(o.tagName)){let n=yield function(e,n){return t(this,null,function*(){let r=d(e,n,"jt-loading"),l=d(e,n,"jt-error");s(r),p(l);try{let e=yield function(e){return t(this,null,function*(){let{url:t,options:n}=function(t){let e=t.getAttribute("action")||t.getAttribute("href"),n=(t.getAttribute("method")||"GET").toUpperCase(),r={method:n,headers:{}};if(["post","put","patch"].includes(n)){let e=function(t){let e=new FormData(t),n={};for(let[t,r]of e.entries())n[t]=r;return n}(t);r.body=JSON.stringify(e),r.headers={"Content-Type":"application/json"}}return{url:e,options:r}}(e);try{yield a(e.getAttribute("jt-pre-request-fn"),e,n);let r=yield fetch(t,n),l=yield function(t){return t.headers.get("Content-Type").includes("text/html")?t.text():t.json()}(r);if(yield a(e.getAttribute("jt-post-request-fn"),e,r,l),!r.ok)throw{status:r.status,body:l};return l}catch(n){throw yield a(e.getAttribute("jt-request-error-fn"),e,n),console.error("[jtml] fetch failed:",t,n),n}})}(n);return p(r),p(l),e}catch(t){p(r),s(l),console.error("Form request failed:",t)}})}(e,o);if(!n)return;return void l(n)}l(i)}})}function a(e,...n){return t(this,null,function*(){let t=window[e];return t&&t(...n)})}function d(t,e,n){let r=e.getAttribute(n);if(!r)return null;try{return t.querySelector(r)}catch(t){return console.warn(`[jtml] Invalid ${n} selector "${r}"`),null}}function s(t){t&&(t.style.display="")}function p(t){t&&(t.style.display="none")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>u.apply()):u.apply()})();