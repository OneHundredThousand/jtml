(()=>{var e=Object.defineProperty,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,o=(e,o)=>{for(var i in o||(o={}))r.call(o,i)&&l(e,i,o[i]);if(t)for(var i of t(o))n.call(o,i)&&l(e,i,o[i]);return e},i=(e,t,r)=>new Promise((n,l)=>{var o=e=>{try{u(r.next(e))}catch(e){l(e)}},i=e=>{try{u(r.throw(e))}catch(e){l(e)}},u=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,i);u((r=r.apply(e,t)).next())});function u(e){let t=[];for(let r of e){let e=a(r);e&&t.push(e)}return t}function a(e){if(e.nodeType===Node.TEXT_NODE){let t=e.textContent;return t&&t.length?{type:"text",raw:t}:null}if(e.nodeType!==Node.ELEMENT_NODE)return null;let t=e.getAttribute("jt-foreach"),r=f(e.getAttribute("jt-text")),n=function(e){let t=[];for(let r of e.attributes)if(r.name.startsWith("jt-attr:")){let[,e]=r.name.split(":"),n=f(r.value);t.push((t,r)=>{t.setAttribute(e,n(r))})}return t}(e),l=function(e){let t=e.getAttribute("jt-if");if(!t)return null;let r,n={eq:(e,t)=>e===t,neq:(e,t)=>e!==t,gt:(e,t)=>e>t,lt:(e,t)=>e<t,gte:(e,t)=>e>=t,lte:(e,t)=>e<=t},[l,o,i]=t.trim().split(/\s+/),u=n[o];if(!u)throw new Error("Unknown operator: "+o);r=/^'.*'$/.test(i)?i.slice(1,-1):isNaN(Number(i))?e=>e[i]:Number(i);let a=e=>e[l];return e=>{let t=a(e),n="function"==typeof r?r(e):r;return u(t,n)}}(e);return{type:"element",node:e,foreach:t,text:r,ifExpr:l,binders:n,children:u(e.childNodes)}}function f(e){if(null==e||!e.length)return;let t=[],r=e.length,n=0,l=0;for(;n<r;){if("{"!==e[n]){n++;continue}n>l&&t.push({type:"text",value:e.slice(l,n)});let o=n+1,i=o;for(;i<r&&"}"!==e[i];)i++;if(i===r)return t.push({type:"text",value:e.slice(n)}),t;t.push({type:"path",value:e.slice(o,i)}),n=i+1,l=n}return l<r&&t.push({type:"text",value:e.slice(l)}),e=>{let r="";if(1===t.length){let n=d(e,t[0].value);r+=n?String(n):t[0].value}else for(let n of t)if("text"!==n.type){if("path"===n.type){let t=d(e,n.value);r+=t?String(t):n.value}}else r+=n.value;return r}}function c(e,t,r){let{type:n,node:l,foreach:o,text:i,ifExpr:u,binders:a,children:f}=e;if("text"===n)return document.createTextNode(e.raw);if(u&&!u(t))return;if(o){let e=d(t,o);if(!Array.isArray(e))return null;let n=document.createDocumentFragment();for(let t of e){let e=l.cloneNode(!1);for(let n of f){let l=c(n,t,r);r&&l&&e.appendChild(l)}n.appendChild(e)}return n}let p=r?l.cloneNode(!1):l;if(i){let e=i(t);e&&(p.textContent=e)}for(let e of a)e(p,t);for(let e of f){let n=c(e,t,r);r&&n&&p.appendChild(n)}return p}function d(e,t){let r=e;for(let e of t.split(".")){if(!r)return;r=r[e]}return r}var p=["jt-click","jt-submit","jt-input","jt-change","jt-load"],s={apply:function(e=document.body){let t=e.querySelectorAll("[jt-scope]");for(let e of t)s.bindDom(e)},bindDom:function(e,t=e){var r;console.log("Processing JTML el:",t);let n=null==(r=window[t.getAttribute("jt-scope")])?void 0:r.call(window),l=t.querySelectorAll(`[${p.join("],[")}]`);for(let t of l)t._redered||(h(e,t,n),t._redered=!0)}};function h(e,t,r){let n=m(e,t,"jt-source")||t,l=function(e,t){let r,n=t.hasAttribute("jt-html")?null:m(e,t,"jt-render")||t;if(n){if(n._renderer)return n._renderer;r=function(e){let t=e instanceof HTMLTemplateElement,r=u(t?e.content.childNodes:[e]);return function(e){let n=t?document.createDocumentFragment():null;for(let l of r){let r=c(l,e,t);t&&r&&n.appendChild(r)}return n}}(n)}let l=m(e,t,"jt-target")||t,o=function(e){let t={replace:(e,t)=>e.replaceChildren(t),append:(e,t)=>e.appendChild(t),prepend:(e,t)=>e.prepend(t)},r={replace:(e,t)=>e.innerHTML=t,append:(e,t)=>e.innerHTML+=t,prepend:(e,t)=>e.innerHTML=t+e.innerHTML},n=e.getAttribute("jt-swap")||"replace";return(e.hasAttribute("jt-html")?r:t)[n]}(t),i=t=>{let n=t;r&&(n=r(t)),n&&l&&(o(l,n),s.bindDom(e,l))};return n&&(n._renderer=i),i}(e,t);for(let o of p){let i=t.getAttribute(o);if(null!==i){if("jt-load"===o){y(e,t,i,l,r,n);continue}t.addEventListener(o.slice(3),o=>y(e,t,i,l,r,n,o))}}}function y(e,t,r,n,l,u,a){return i(this,null,function*(){var f,c;null==(f=null==a?void 0:a.preventDefault)||f.call(a);let d=window[r];if(!1===("AsyncFunction"===(null==(c=null==d?void 0:d.constructor)?void 0:c.name)?yield d(t,a):null==d?void 0:d(t,a)))return;let p=l;if("FORM"===u.tagName||"A"===u.tagName){let r=yield function(e,t){return i(this,null,function*(){let r=m(e,t,"jt-loading"),n=m(e,t,"jt-error");b(r),g(n);try{let e=yield function(e){return i(this,null,function*(){let{url:t,options:r}=function(e){let t=e.getAttribute("action")||e.getAttribute("href"),r=(e.getAttribute("method")||"GET").toUpperCase(),n={method:r,headers:{}};if(["post","put","patch"].includes(r)){let t=function(e){if("FORM"!==e.tagName)return{};let t=new FormData(e),r={};for(let[e,n]of t.entries())r[e]=n;return r}(e);n.body=JSON.stringify(t),n.headers={"Content-Type":"application/json"}}return{url:t,options:n}}(e),n=e.getAttribute("jt-pre-request-fn");if(n){(0,window[n])(e,r)}try{let n=yield fetch(t,r),l=yield function(e){var t;return null!=(t=e.headers.get("Content-Type"))&&t.includes("text/html")?e.text():e.json()}(n),o=e.getAttribute("jt-post-request-fn");if(o){(0,window[o])(e,n,l)}if(!n.ok)throw{status:n.status,body:l};return l}catch(r){if(e.getAttribute("jt-request-error-fn")){let t=window[t];t(e,r)}throw console.error("[jtml] fetch failed:",t,r),r}})}(t);return g(r),g(n),e}catch(e){g(r),b(n),console.error("Form request failed:",e)}})}(e,u);if(!r)return;p=t.hasAttribute("jt-html")?r:o(o({},p),r)}n(p)})}function m(e,t,r){let n=t.getAttribute(r);if(!n)return null;try{return e.querySelector(n)}catch(e){return console.warn(`[jtml] Invalid ${r} selector "${n}"`),null}}function b(e){e&&(e.style.display="")}function g(e){e&&(e.style.display="none")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>s.apply()):s.apply(),window.JTML=s})();