(()=>{var t=(t,e,r)=>new Promise((n,l)=>{var o=t=>{try{u(r.next(t))}catch(t){l(t)}},i=t=>{try{u(r.throw(t))}catch(t){l(t)}},u=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,i);u((r=r.apply(t,e)).next())});function e(t){if(t.nodeType===Node.TEXT_NODE){let e=t.textContent;return e&&e.length?{type:"text",raw:e}:null}if(t.nodeType!==Node.ELEMENT_NODE)return null;let r=t.getAttribute("jt-foreach"),n=t.getAttribute("jt-text"),l=function(t){let e=[];for(let r of t.attributes)if(r.name.startsWith("jt-attr:")){let[,t]=r.name.split(":");e.push((e,n)=>{e.setAttribute(t,n[r.value])})}return e}(t),o=function(t){let e=t.getAttribute("jt-if");if(!e)return null;let r,n={eq:(t,e)=>t===e,neq:(t,e)=>t!==e,gt:(t,e)=>t>e,lt:(t,e)=>t<e,gte:(t,e)=>t>=e,lte:(t,e)=>t<=e},[l,o,i]=e.trim().split(/\s+/),u=n[o];if(!u)throw new Error("Unknown operator: "+o);r=/^'.*'$/.test(i)?i.slice(1,-1):isNaN(Number(i))?t=>t[i]:Number(i);let a=t=>t[l];return t=>{let e=a(t),n="function"==typeof r?r(t):r;return u(e,n)}}(t);return{type:"element",node:t,foreach:r,text:n,ifExpr:o,binders:l,children:Array.from(t.childNodes).map(e).filter(Boolean)}}function r(t,e,l){let{type:o,node:i,foreach:u,text:a,ifExpr:c,binders:f,children:d}=t;if("text"===o)return document.createTextNode(t.raw);if(c&&!c(e))return;if(u){let t=n(e,u);if(!Array.isArray(t))return null;let o=document.createDocumentFragment();for(let e of t){let t=i.cloneNode(!1);t.removeAttribute("jt-foreach");for(let n of d){let o=r(n,e,l);o&&t.appendChild(o)}o.appendChild(t)}return o}let s=l?i.cloneNode(!1):i;if(a){let t=n(e,a);t&&(s.textContent=t)}f.forEach(t=>t(s,e));for(let t of d){let n=r(t,e,l);l&&n&&s.appendChild(n)}return s}function n(t,e){if("."===e)return t;return l(t,e)||function(t,e){let r="",n=0;for(;n<t.length;){let o=t.indexOf("{{",n);if(-1===o){r+=t.slice(n);break}r+=t.slice(n,o);let i=t.indexOf("}}",o);if(-1===i){r+=t.slice(o);break}r+=l(e,t.slice(o+2,i).trim()),n=i+2}return r}(e,t)}function l(t,e){let r=t;for(let t=0,n=e.split(".");t<n.length;t++){if(null==r)return;r=r[n[t]]}return r}var o=["jt-click","jt-submit","jt-input","jt-change","jt-load"],i={apply:function(t=document){t.querySelectorAll("[jt-scope]").forEach(t=>{var e;console.log("Processing JTML scope:",t);let r=null==(e=window[t.getAttribute("jt-scope")])?void 0:e.call(window),n=t.querySelectorAll("form"),l=t.querySelectorAll("a");n.forEach(e=>function(t,e){let r=e.querySelectorAll("[jt-submit-form]"),n=u(t,e),l=r=>{r&&r.preventDefault(),c(t,e,n)};e.hasAttribute("jt-load")&&l(),e.addEventListener("submit",l),r.forEach(t=>{let e=t.getAttribute("jt-submit-form");t.addEventListener(e,l)})}(t,e)),l.forEach(e=>function(t,e){let r=u(t,e),n=n=>{n&&n.preventDefault(),c(t,e,r)};e.hasAttribute("jt-load")&&n(),e.addEventListener("click",n)}(t,e)),function(t,e){let r=t.querySelectorAll(`[${o.join("],[")}]`);for(let n of r)for(let r of o){if("FORM"===n.tagName||"A"===n.tagName||!n.hasAttribute(r))continue;let l=n.getAttribute(r),o=u(t,n);"jt-load"!==r?n.addEventListener(d(r),t=>f(n,l,o,e,t)):f(n,l,o,e)}}(t,r)})}};function u(t,n){let l,o=function(t){let e=t.getAttribute("jt-swap")||"replace",r=t.hasAttribute("jt-html");switch(e){case"replace":return function(t){return t?(t,e)=>t.innerHTML=e:(t,e)=>t.replaceChildren(e)}(r);case"append":return function(t){return t?(t,e)=>t.innerHTML+=e:(t,e)=>t.appendChild(e)}(r);case"prepend":return function(t){return t?(t,e)=>t.innerHTML=e+t.innerHTML:(t,e)=>t.prepend(e)}(r)}}(n),i=s(t,n,"jt-target"),u=s(t,n,"jt-render");return u&&(l=function(t){let n=t instanceof HTMLTemplateElement,l=Array.from(n?t.content.childNodes:t.children).map(e).filter(Boolean);return function(t){let e=n?document.createDocumentFragment():null;for(let o of l){let l=r(o,t,n);n&&l&&e.appendChild(l)}return e}}(u)),t=>{let e=t;l&&(e=l(t)),e&&i&&o(i,e)}}function a(e){return t(this,null,function*(){let{url:t,options:r}=function(t){let e=t.getAttribute("action")||t.getAttribute("href"),r=(t.getAttribute("method")||"GET").toUpperCase(),n={method:r,headers:{}};if(["post","put","patch"].includes(r)){let e=function(t){if("FORM"!==t.tagName)return{};let e=new FormData(t),r={};for(let[t,n]of e.entries())r[t]=n;return r}(t);n.body=JSON.stringify(e),n.headers={"Content-Type":"application/json"}}return{url:e,options:n}}(e),n=e.getAttribute("jt-pre-request-fn");if(n){(0,window[n])(e,r)}try{let n=yield fetch(t,r),l=yield function(t){var e;return null!=(e=t.headers.get("Content-Type"))&&e.includes("text/html")?t.text():t.json()}(n),o=e.getAttribute("jt-post-request-fn");if(o){(0,window[o])(e,n,l)}if(!n.ok)throw{status:n.status,body:l};return l}catch(r){if(e.getAttribute("jt-request-error-fn")){let t=window[t];t(e,r)}throw console.error("[jtml] fetch failed:",t,r),r}})}function c(e,r,n){return t(this,null,function*(){let t=s(e,r,"jt-loading"),l=s(e,r,"jt-error");p(t),h(l);try{let e=yield a(r);h(t),h(l),n(e)}catch(e){h(t),p(l),console.error("Form request failed:",e)}})}function f(t,e,r,n,l){let o=window[e],i=null==o?void 0:o(t,l);i instanceof Promise?i.then(()=>{r(n)}):r(n)}function d(t){return t.slice(3)}function s(t,e,r){let n=e.getAttribute(r);if(!n)return null;try{return t.querySelector(n)}catch(t){return console.warn(`[jtml] Invalid ${r} selector "${n}"`),null}}function p(t){t&&(t.style.display="")}function h(t){t&&(t.style.display="none")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>i.apply()):i.apply(),window.JTML=i})();